<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hakos Mining v31.6 ADMIN</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #000; --neon: #00ff88; --glass: rgba(255, 255, 255, 0.07); --border: rgba(255, 255, 255, 0.1); }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; user-select: none; outline: none; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        canvas { position: fixed; inset: 0; z-index: 1; opacity: 0.12; pointer-events: none; }
        .version { position: fixed; bottom: 8px; right: 12px; font-size: 8px; color: rgba(255,255,255,0.1); z-index: 10001; }
        .app { position: relative; z-index: 10; display: none; flex-direction: column; height: 100vh; padding: 10px 20px 110px; }
        #start-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card { background: var(--glass); backdrop-filter: blur(25px); border-radius: 25px; border: 1px solid var(--border); padding: 20px; text-align: center; margin-bottom: 12px; }
        .hk-val { font-size: 34px; font-weight: 800; text-shadow: 0 0 15px rgba(0, 255, 136, 0.3); }
        .btn-buy { background: var(--neon); color: #000; border: none; padding: 12px 18px; border-radius: 15px; font-weight: 900; font-size: 11px; cursor: pointer; }
        .tap-pill { width: 100%; height: 160px; background: var(--glass); border-radius: 40px; border: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 10px 0; }
        .nav { position: fixed; bottom: 30px; left: 15px; right: 15px; display: flex; justify-content: space-around; background: rgba(10,10,10,0.85); backdrop-filter: blur(20px); padding: 15px 5px; border-radius: 25px; border: 1px solid var(--border); z-index: 5000; }
        .nav-item { color: rgba(255,255,255,0.3); border: none; background: none; font-size: 9px; font-weight: 900; }
        .nav-item.active { color: var(--neon); }
        .screen { display: none; flex-direction: column; height: 100%; overflow-y: auto; }
        .screen.active { display: flex; }
        .ios-notif { position: fixed; top: -120px; left: 50%; transform: translateX(-50%); width: 85%; background: rgba(20,20,20,0.98); border-radius: 22px; padding: 18px; text-align: center; z-index: 20000; transition: 0.6s; color: var(--neon); font-weight: bold; border: 1px solid var(--border); }
        .ios-notif.show { top: 25px; }
        input { background: none; border: none; color: #fff; text-align: center; width: 100%; font-size: 12px; letter-spacing: 2px; }
        
        /* Эффект вспышки для админа */
        .admin-flash { animation: flash 0.5s ease-out; }
        @keyframes flash { 0% { background: var(--neon); opacity: 0.5; } 100% { background: transparent; opacity: 1; } }
    </style>
</head>
<body id="main-body">

<div class="version">v31.6 ADMIN_EDITION</div>
<div id="notif" class="ios-notif"></div>
<canvas id="matrix"></canvas>

<div id="start-screen">
    <div style="font-size: 40px; font-weight: 900; color: var(--neon); letter-spacing: 5px;">HAKOS</div>
    <div style="margin-top: 20px;">
        <button onclick="entry('save')" style="background:var(--neon); color:#000; border:none; padding:18px; border-radius:20px; font-weight:900; width:200px; margin-bottom:10px;">ВХОД</button>
        <br>
        <button onclick="entry('demo')" style="background:none; color:#fff; border:1px solid var(--border); padding:10px; border-radius:15px; width:200px;">GUEST MODE</button>
    </div>
</div>

<div class="app" id="app">
    <div id="home-screen" class="screen active">
        <div class="card">
            <div id="user-display" style="font-size:10px; color:var(--neon); opacity:0.6">ID: ...</div>
            <div id="hk-num" class="hk-val">0.000000</div>
            <div id="ps-num" style="font-size:12px; color:var(--neon);">0.00000 HK/s</div>
        </div>
        
        <div class="card" style="padding:10px">
            <input type="text" id="p-input" oninput="checkPromo()" placeholder="ПРОМОКОД / PROMO">
        </div>

        <div class="card" style="display:flex; justify-content:space-between; align-items:center">
            <div style="text-align:left"><b>Micro Miner</b><br><small>+0.084/h</small></div>
            <button class="btn-buy" onclick="buy(3.39, 0.084)">3.39 HK</button>
        </div>
    </div>

    <div id="click-screen" class="screen">
        <div class="card" style="display:flex; justify-content:space-around; font-size:10px;">
            <div>LVL: <span id="tap-lvl" style="color:var(--neon)">1</span></div>
            <div>TOTAL: <span id="tap-total" style="color:var(--neon)">0</span></div>
        </div>

        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
            <div style="text-align:left"><b>AUTOTAP</b><br><small id="at-rate" style="color:var(--neon)">0.0 cl/s</small></div>
            <button id="at-btn" class="btn-buy" onclick="buyAutoTap()">59 HK</button>
        </div>

        <div class="tap-pill" onclick="tap()">
            <span id="target-txt" style="font-size:10px; opacity:0.5;">1000 LEFT</span>
            <span style="font-size:40px; font-weight:900; color:var(--neon);">TAP</span>
        </div>
    </div>

    <div class="nav">
        <button class="nav-item active" id="n-home" onclick="nav('home')">HOME</button>
        <button class="nav-item" id="n-click" onclick="nav('click')">MINING</button>
    </div>
</div>

<script type="module">
    // --- ПЕРЕМЕННЫЕ ИГРЫ ---
    let hk = 0, hp = 0.02, myNick = 'USER', userId = '12345';
    let tapLvl = 1, tapTotal = 0, tapProgress = 0;
    let atR = 0, atP = 59, usedPromos = [];
    const tg = window.Telegram.WebApp;

    window.entry = (mode) => {
        if(mode === 'demo') { myNick = "ADMIN"; } // Для теста админ-кода
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        runGame();
    };

    function runGame() {
        setInterval(() => {
            hk += (hp / 3600) / 10; // Пассивный доход
            
            if(atR > 0) { // Автотап
                let step = atR / 10;
                tapProgress += step;
                tapTotal += step;
                if(tapProgress >= 1000) {
                    tapLvl++; tapProgress = 0;
                    hk += (0.05 + (tapLvl * 0.01));
                }
            }
            updateUI();
        }, 100);
    }

    // --- ФУНКЦИЯ ПРОМОКОДОВ (ТУТ ТВОЯ МАГИЯ) ---
    window.checkPromo = () => {
        let v = document.getElementById('p-input').value.toUpperCase().trim();
        
        // 1. БЕСКОНЕЧНЫЙ АДМИН-ТАП
        if(v === "/ADMINTAP") {
            // Проверка: ник должен быть ADMIN
            if(myNick === "ADMIN") {
                atR += 0.5; // Даем +0.5 к клику
                showNotif("ADMIN POWER: +0.5 CL/S", 1000);
                
                // Визуальный эффект вспышки
                document.getElementById('main-body').classList.add('admin-flash');
                setTimeout(() => document.getElementById('main-body').classList.remove('admin-flash'), 500);
                
                tg.HapticFeedback.notificationOccurred('success');
                document.getElementById('p-input').value = ""; // Очищаем
                updateUI();
            } else {
                showNotif("ERROR: NOT ADMIN", 2000);
            }
            return;
        }

        // 2. ОБЫЧНЫЕ ПРОМО
        if(usedPromos.includes(v)) return;

        if(v === "XYRO") {
            hk += 5;
            usedPromos.push(v);
            showNotif("+5 HK!", 3000);
            document.getElementById('p-input').value = "";
        }

        if(v === "/NOTBAN") {
            hk += 10;
            usedPromos.push(v);
            showNotif("ADMIN PANEL UNLOCKED", 3000);
            document.getElementById('p-input').value = "";
        }
    };

    window.buyAutoTap = () => {
        if(hk >= atP) { hk -= atP; atR += 0.3; atP = Math.floor(atP * 2.2); showNotif("UPGRADED!"); }
        else showNotif("NEED MORE HK");
    };

    window.tap = () => {
        tapProgress++; tapTotal++;
        if(tapProgress >= 1000) { tapLvl++; tapProgress = 0; hk += (0.05 + (tapLvl * 0.01)); }
        tg.HapticFeedback.impactOccurred('light');
    };

    window.nav = (s) => {
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
        document.getElementById(s + '-screen').classList.add('active');
        document.getElementById('n-' + s).classList.add('active');
    };

    function updateUI() {
        document.getElementById('hk-num').innerText = hk.toFixed(6);
        document.getElementById('user-display').innerText = "ID: " + myNick;
        document.getElementById('at-rate').innerText = atR.toFixed(1) + " click/s";
        document.getElementById('at-btn').innerText = atP + " HK";
        document.getElementById('tap-lvl').innerText = tapLvl;
        document.getElementById('tap-total').innerText = Math.floor(tapTotal);
        document.getElementById('target-txt').innerText = Math.floor(1000 - tapProgress) + " LEFT";
        document.getElementById('ps-num').innerText = (hp/3600).toFixed(5) + " HK/s";
    }

    function showNotif(t, d=2000) {
        let n = document.getElementById('notif'); n.innerText = t; n.classList.add('show');
        setTimeout(() => n.classList.remove('show'), d);
    }

    // Matrix background
    const cv = document.getElementById('matrix'), cx = cv.getContext('2d');
    cv.width = window.innerWidth; cv.height = window.innerHeight;
    const dr = Array(25).fill(1);
    setInterval(() => {
        cx.fillStyle = "rgba(0,0,0,0.1)"; cx.fillRect(0,0,cv.width,cv.height);
        cx.fillStyle = "#0f8"; cx.font = "10px monospace";
        dr.forEach((y, i) => { cx.fillText("HK", i*25, y*15); if(y*15 > cv.height && Math.random() > 0.9) dr[i]=0; dr[i]++; });
    }, 100);
</script>
</body>
</html>
