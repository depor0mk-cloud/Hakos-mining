<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HKos Cloud Global</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #000; --card-bg: #0a0a0a; --neon: #00ff88; --shadow: 0 0 15px rgba(0,255,136,0.5); }
        * { -webkit-tap-highlight-color: transparent; user-select: none; box-sizing: border-box; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: #fff; font-family: 'Arial Black', sans-serif; height: 100vh; overflow: hidden; }
        canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.15; }
        .app-wrapper { display: flex; flex-direction: column; height: 100vh; padding: 15px 20px 90px; }
        .card { background: var(--card-bg); border-radius: 35px; padding: 25px 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 15px; }
        .hkos-val { font-size: 40px; font-weight: 900; color: var(--neon); text-shadow: var(--shadow); font-family: monospace; }
        .btn-3d { background: var(--neon); color: #000; border: none; padding: 15px; border-radius: 15px; font-weight: 900; font-size: 14px; box-shadow: 0 4px 0 #008844; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn-3d:active { transform: translateY(2px); box-shadow: 0 2px 0 #008844; }
        
        /* –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ */
        .leader-row { display: flex; justify-content: space-between; padding: 12px 10px; border-bottom: 1px solid rgba(0,255,136,0.1); font-family: monospace; font-size: 13px; }
        .rank { color: var(--neon); font-weight: 900; margin-right: 8px; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 20000; display: none; align-items: center; justify-content: center; opacity: 0; transition: 0.3s; }
        .modal-content { background: #0f0f0f; border: 3px solid var(--neon); border-radius: 40px; padding: 35px 25px; text-align: center; width: 85%; transform: scale(0.8); transition: 0.3s; box-shadow: var(--shadow); }
        .modal-overlay.show { opacity: 1; display: flex; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .progress-box { width: 100%; background: #111; height: 12px; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .bar { width: 0%; height: 100%; background: var(--neon); box-shadow: var(--shadow); transition: 0.1s; }
        
        .nav { position: fixed; bottom: 25px; left: 15px; right: 15px; display: flex; justify-content: space-around; padding: 15px; background: rgba(10,10,10,0.98); backdrop-filter: blur(15px); border-radius: 25px; border: 1px solid rgba(255,255,255,0.08); }
        .nav-item { font-size: 9px; font-weight: 900; color: #444; text-transform: uppercase; border: none; background: none; }
        .nav-item.active { color: var(--neon); text-shadow: var(--shadow); }
        
        .screen { display: none; flex-direction: column; height: 100%; }
        .screen.active { display: flex; }
        .lang-btn { position: absolute; top: 20px; right: 20px; background: #111; border: 1px solid var(--neon); color: var(--neon); padding: 5px 10px; border-radius: 10px; font-size: 10px; font-weight: 900; }
        input { background: transparent; border: none; color: var(--neon); text-align: center; width: 100%; outline: none; font-weight: 900; font-size: 16px; }
        #ban-screen { position: fixed; inset: 0; background: #000; z-index: 30000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body>
<canvas id="matrix"></canvas>

<button class="lang-btn" onclick="toggleLang()">RU / EN</button>

<div id="m-reward" class="modal-overlay"><div class="modal-content"><div>üíé</div><h2 id="m-rew-title" style="font-weight:900">–£–°–ü–ï–•!</h2><div id="reward-amt" style="font-size:24px;color:var(--neon);font-weight:900;margin:15px 0">+0.0000 HKos</div><button class="btn-3d" id="btn-collect" onclick="closeM('m-reward')">–ó–ê–ë–†–ê–¢–¨</button></div></div>
<div id="m-promo" class="modal-overlay"><div class="modal-content"><div>üîë</div><h2 id="m-pro-title" style="font-weight:900">–ê–ö–¢–ò–í–ê–¶–ò–Ø</h2><div id="promo-val-text" style="font-size:24px;color:var(--neon);font-weight:900;margin:15px 0">+0.0000 HKos</div><button class="btn-3d" id="btn-ok" onclick="closeM('m-promo')">–û–¢–õ–ò–ß–ù–û</button></div></div>

<div id="ban-screen"><h1 style="color:#ff3e3e;font-weight:900">SYSTEM BLOCKED</h1><p style="color:#555">SECURITY ALERT: HIGH CPS</p><input type="text" id="adm-unlock" placeholder="CODE" oninput="checkAdm()" style="margin-top:30px"></div>

<div class="app-wrapper">
    <div id="home-screen" class="screen active">
        <div class="card">
            <div style="font-size:10px;color:#444;font-weight:900" id="user-display-id">LOADING...</div>
            <div id="hk-num" class="hkos-val">0.00000000</div>
            <div id="ps-num" style="font-size:12px;color:#555">0.00000 HK/s</div>
        </div>
        <div id="p-area" class="card" style="padding:15px;border:2px dashed #111;"><input type="text" id="p-input" placeholder="..."></div>
        <div style="overflow-y:auto;flex:1;padding-bottom:10px;">
            <div class="card" style="display:flex;justify-content:space-between;align-items:center;padding:15px;margin-bottom:10px;"><div><b id="m1-t">–°–õ–ê–ë–´–ô</b><br><small style="color:var(--neon)">+0.07/h</small></div><button class="btn-3d" style="width:80px" onclick="buy(3, 0.07)">3 HK</button></div>
            <div class="card" style="display:flex;justify-content:space-between;align-items:center;padding:15px;margin-bottom:10px;"><div><b id="m2-t">–°–†–ï–î–ù–ò–ô</b><br><small style="color:var(--neon)">+0.40/h</small></div><button class="btn-3d" style="width:80px" onclick="buy(15, 0.4)">15 HK</button></div>
            <div class="card" style="display:flex;justify-content:space-between;align-items:center;padding:15px;margin-bottom:10px;"><div><b id="m3-t">–ú–û–©–ù–´–ô</b><br><small style="color:var(--neon)">+1.50/h</small></div><button class="btn-3d" style="width:80px" onclick="buy(50, 1.5)">50 HK</button></div>
        </div>
    </div>

    <div id="click-screen" class="screen">
        <div class="card">
            <h2 id="target-txt" style="margin:0;font-weight:900">GOAL: 0 / 10</h2>
            <div class="progress-box"><div id="bar" class="bar"></div></div>
            <button class="btn-3d" style="padding:50px;font-size:32px" onclick="tap()">TAP</button>
        </div>
    </div>

    <div id="top-screen" class="screen">
        <div class="card" style="flex:1; overflow-y:auto; padding: 20px 10px;">
            <h2 id="top-title" style="margin-top:0; font-weight:900; color:var(--neon);">TOP PLAYERS</h2>
            <div id="leaderboard-list"><div style="color:#222; margin-top:50px;">SYNC...</div></div>
        </div>
    </div>

    <div class="nav">
        <button id="n-home" class="nav-item active" onclick="nav('home')">HOME</button>
        <button id="n-click" class="nav-item" onclick="nav('click')">TAP</button>
        <button id="n-top" class="nav-item" onclick="nav('top')">TOP</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, set, get, child, update, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBD-uKyTOd3iXNkisXyCkpgeXYzG4oySHM",
        authDomain: "hkos-project.firebaseapp.com",
        projectId: "hkos-project",
        databaseURL: "https://hkos-project-default-rtdb.europe-west1.firebasedatabase.app",
        storageBucket: "hkos-project.firebasestorage.app",
        messagingSenderId: "956154333649",
        appId: "1:956154333649:web:7f8c5f9e64fe81dc5d78f0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tg = window.Telegram.WebApp;
    tg.expand();

    const userId = tg.initDataUnsafe?.user?.id || "dev_local";
    const anonId = "USER_" + String(userId).substring(0, 4) + "...";
    
    let hk = 0, hp = 0.02, si = 0, ib = false, pu = [], lv = Date.now(), lang = "RU";
    let stp = [10, 15, 20, 30, 50, 80, 100], cc = 0, ct = [];

    const i18n = {
        RU: { home: "–ì–ª–∞–≤–Ω–∞—è", tap: "–ö–ª–∏–∫–µ—Ä", top: "–õ–∏–¥–µ—Ä—ã", goal: "–¶–ï–õ–¨", s_m: "–°–õ–ê–ë–´–ô", m_m: "–°–†–ï–î–ù–ò–ô", h_m: "–ú–û–©–ù–´–ô", promo: "–ü–†–û–ú–û–ö–û–î", wait: "–°–ò–ù–•–†–û–ù...", rew_t: "–£–°–ü–ï–•!", pro_t: "–ê–ö–¢–ò–í–ê–¶–ò–Ø", coll: "–ó–ê–ë–†–ê–¢–¨", ok: "–û–ö" },
        EN: { home: "Home", tap: "Clicker", top: "Top", goal: "GOAL", s_m: "WEAK", m_m: "NORMAL", h_m: "STRONG", promo: "PROMOCODE", wait: "SYNC...", rew_t: "SUCCESS!", pro_t: "PROMO", coll: "COLLECT", ok: "OK" }
    };

    function updateLang() {
        const t = i18n[lang];
        document.getElementById('n-home').innerText = t.home;
        document.getElementById('n-click').innerText = t.tap;
        document.getElementById('n-top').innerText = t.top;
        document.getElementById('m1-t').innerText = t.s_m;
        document.getElementById('m2-t').innerText = t.m_m;
        document.getElementById('m3-t').innerText = t.h_m;
        document.getElementById('p-input').placeholder = t.promo;
        document.getElementById('top-title').innerText = "TOP ANONYMOUS";
        document.getElementById('m-rew-title').innerText = t.rew_t;
        document.getElementById('m-pro-title').innerText = t.pro_t;
        document.getElementById('btn-collect').innerText = t.coll;
        document.getElementById('btn-ok').innerText = t.ok;
        sync();
    }

    window.toggleLang = () => { lang = (lang === "RU") ? "EN" : "RU"; updateLang(); saveCloud(); };

    async function loadCloud() {
        try {
            const snap = await get(child(ref(db), `users/${userId}`));
            if (snap.exists()) {
                const d = snap.val();
                hk = d.hk || 0; hp = d.hp || 0.02; si = d.si || 0;
                ib = d.ib || false; pu = d.pu || []; lv = d.lv || Date.now();
                lang = d.lang || "RU";
                
                let diff = Math.floor((Date.now() - lv) / 1000);
                if (diff > 60) {
                    let earned = (hp / 3600) * Math.min(diff, 5400);
                    hk += earned;
                    tg.showAlert(lang === "RU" ? `–î–æ–±—ã—Ç–æ: ${earned.toFixed(5)} HKos` : `Mined: ${earned.toFixed(5)} HKos`);
                }
            } else { saveCloud(); }
            updateLang();
        } catch (e) { console.error(e); }
        loadLeaderboard();
    }

    function saveCloud() {
        update(ref(db, `users/${userId}`), {
            hk: hk, hp: hp, si: si, ib: ib, pu: pu, lv: Date.now(), anon: anonId, lang: lang
        });
    }

    async function loadLeaderboard() {
        const topQ = query(ref(db, 'users'), orderByChild('hk'), limitToLast(10));
        try {
            const snap = await get(topQ);
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = "";
            let p = []; snap.forEach(c => { p.push(c.val()); });
            p.reverse().forEach((u, i) => {
                const r = document.createElement('div');
                r.className = 'leader-row';
                r.innerHTML = `<span><span class="rank">#${i+1}</span> ${u.anon}</span><b>${parseFloat(u.hk).toFixed(4)}</b>`;
                list.appendChild(r);
            });
        } catch (e) { }
    }

    window.tap = function() {
        if(ib) return;
        const n = Date.now(); ct.push(n);
        ct = ct.filter(t => n - t < 1000);
        if(ct.length > 15) { ib = true; saveCloud(); location.reload(); return; }
        cc++;
        let t = stp[si] || (100 + (si-6)*20);
        document.getElementById('bar').style.width = (cc/t*100) + "%";
        document.getElementById('target-txt').innerText = `${i18n[lang].goal}: ${cc} / ${t}`;
        tg.HapticFeedback.impactOccurred('light');
        if(cc >= t) {
            let r = Math.random() < 0.1 ? 0.015 : 0.003;
            hk += r; cc = 0; si++;
            openM('m-reward', "+" + r.toFixed(4) + " HKos");
            sync(); saveCloud();
        }
    };

    window.buy = (c, p) => {
        if(hk >= c) { hk -= c; hp += p; tg.HapticFeedback.notificationOccurred('success'); sync(); saveCloud(); }
        else tg.showAlert("NO HKos");
    };

    window.checkPr = () => {
        let v = document.getElementById('p-input').value.trim().toUpperCase();
        if(!v) return;
        const _d = (s) => decodeURIComponent(escape(atob(s)));
        if (["L9Ch0J3QrNCi0KzQkdCQ0J0=", "L9Ch0J3QrNCi0KzQnNCj0KI="].some(p => v === _d(p))) {
            ib = false; document.getElementById('ban-screen').style.display = 'none';
            document.getElementById('p-input').value = ""; saveCloud(); return;
        }
        let r = 0, pk = "";
        if(v === _d("0KfQm9CV0J3QntCf0J7QotCQ0J0=")) { r = 5; pk = "p1"; }
        if(pk && !pu.includes(pk)) { hk += r; pu.push(pk); document.getElementById('p-input').value = ""; openM('m-promo', `+${r} HKos`); sync(); saveCloud(); }
    };

    function sync() {
        document.getElementById('hk-num').innerText = hk.toFixed(8);
        document.getElementById('ps-num').innerText = (hp/3600).toFixed(5) + " HK/s";
        let t = stp[si] || (100 + (si-6)*20);
        document.getElementById('target-txt').innerText = `${i18n[lang].goal}: ${cc} / ${t}`;
        document.getElementById('bar').style.width = (cc/t*100) + "%";
        document.getElementById('user-display-id').innerText = anonId;
        if(ib) document.getElementById('ban-screen').style.display = 'flex';
    }

    window.nav = (s) => {
        document.querySelectorAll('.screen').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
        document.getElementById(s + '-screen').classList.add('active');
        document.getElementById('n-' + s).classList.add('active');
        if(s === 'top') loadLeaderboard();
        tg.HapticFeedback.selectionChanged();
    };

    window.closeM = (id) => { document.getElementById(id).classList.remove('show'); setTimeout(() => document.getElementById(id).style.display='none', 300); };
    function openM(id, t) { 
        if(t) { if(id==='m-reward') document.getElementById('reward-amt').innerText=t; else document.getElementById('promo-val-text').innerText=t; }
        document.getElementById(id).style.display='flex'; setTimeout(() => document.getElementById(id).classList.add('show'), 10); 
    }

    const cv = document.getElementById('matrix'), cx = cv.getContext('2d');
    cv.width = window.innerWidth; cv.height = window.innerHeight;
    const dr = Array(Math.floor(cv.width/15)).fill(1);
    function draw() {
        cx.fillStyle = "rgba(0,0,0,0.1)"; cx.fillRect(0,0,cv.width,cv.height);
        cx.fillStyle = "#0f8"; cx.font = "12px monospace"; cx.globalAlpha = 0.2;
        dr.forEach((y, i) => {
            const syms = ["0", "1", "#", "HK", "{", "}", "*"];
            cx.fillText(syms[Math.floor(Math.random()*syms.length)], i*15, y*15);
            if(y*15 > cv.height && Math.random() > 0.975) dr[i] = 0;
            dr[i]++;
        });
    }
    setInterval(draw, 60);
    setInterval(() => { hk += hp/3600/10; sync(); }, 100);
    setInterval(saveCloud, 10000);
    loadCloud();
</script>
</body>
</html>
